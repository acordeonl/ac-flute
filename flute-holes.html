<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../ac-view/ac-led-group.html">
<link rel="import" href="../ac-view/view-audio.html">
<link rel="import" href="./flute-hole.html">
<link rel="import" href="./flute-semi-hole.html">
<link rel="import" href="./bottom-hole.html">


<dom-module id="flute-holes">
    <template>
        <style holes>
            flute-hole{
                margin:12px ;
            }
            flute-hole[is-small]{
                margin:2px; 
            }
            flute-hole[is-medium]{
                margin:2px; 
            }
            [back]{
                position: absolute ; 
                margin-left:-60px ; 
                margin-top:-97px ; 
            }
            [back-shadow] {
                position:absolute ; 
                height:20px;
                width:20px;
                margin-left:-60px ; 
                margin-top:-94px ; 
                background-color: var(--ac-led-shadow,gray);
                border-radius: 100% ; 
            }
            [flute-thumb-hole]{
                height:20px;
                width:20px;
            }   
            flute-semi-hole{
                margin:0px ; 
            }
            [double-hole]{
                margin: 12px ;
                @apply --layout-horizontal;
                @apply --layout-center;
            }
        </style>
        <style sections>
            [section]{
                @apply --layout-center;
                @apply --layout-around-justified;
                @apply --layout-vertical;
                width:39px ; 
                border-radius:3px ; 
                background-color:var(--ac-led-shadow0,gray); ;
            }
            [section][lower]{
                width:50px ; 
                border-radius: 10px ; 
                height: 65px ; 
            }
            [top-mouthpiece]{
                @apply --layout-center-justified;
                @apply --layout-horizontal;
                height:7px;
                width:37px;
                background-color:var(--ac-led-shadow0,gray);
                border-top-right-radius: 7px ;
                border-top-left-radius: 7px ;
            }
            [mouthpiece] {
                border-bottom: 60px solid var(--ac-led-shadow0,gray);;
                border-left: 10px solid transparent;
                border-right: 10px solid transparent;
                height: 0;
                width: 37px;
                border-radius: 5px ;
            }
            [top]{
                @apply --layout-center-justified;
                @apply --layout-horizontal;
                border-radius: 4px ; 
                height:90px;
                width:47px;
                background-color:var(--ac-led-shadow0,gray); ;
            }
            [top-inner]{
                opacity: 0.5 ; 
                border-radius: 2px ; 
                height:15px;
                width:25px;
                margin-top:10px ; 
                background-color:gray ;
            }
            [top-inner2]{
                border-radius: 2px ; 
                height:30px;
                width:25px;
                margin-top:10px ; 
                background-color:var(--ac-led-shadow1,gray); ;
            }
            [bottom-before]{
                border-top-right-radius: 4px ; 
                border-top-left-radius: 4px ; 
                height:20px;
                width:40px;
                background-color:var(--ac-led-shadow0,gray);
            }
            [bottom] {
                border-bottom: 30px solid var(--ac-led-shadow0,gray);;
                border-left: 10px solid transparent;
                border-right: 10px solid transparent;
                width: 40px;
                /* border-radius: 10px ; */
            }
            [bottom-after]{
                height:20px;
                width:70px;
                background-color:var(--ac-led-shadow0,gray);
                border-radius: 10px ;
            }
        </style>
        <style>
            [notes]{
                position: absolute;
                margin-left:-100px ;
                margin-top:-200px;
            }
            [playbackNote]{
                margin-top:12px ; 
                font-size: 18px ;
                font-weight: 400 ; 
                font-size: 26px ;
                color: var(--ac-led-shadow,gray);
            }
            [instrumentNote]{
                margin-top:10px ; 
                font-size: 18px ;
                font-weight: 400 ; 
                font-size: 26px ;
                color: var(--ac-led-shadow,gray);
            }
            [flute]{
                @apply --layout-vertical;
                @apply --layout-center;
            }
            [wrapper]{
                height: 100%;
                width: 100%;
                @apply --layout-center;
                @apply --layout-vertical;
                @apply --layout-center-justified;
            }
        </style>
        <view-audio channel='0'></view-audio>
        <div wrapper>
            <div notes>
                <div playbackNote></div>
                <div instrumentNote></div>
            </div>
            <div back-shadow>   
            </div>
            <div back>
                <div flute-thumb-hole>
                    <flute-semi-hole acLed ac-id='0'channel='0'></flute-semi-hole>
                    <flute-semi-hole rotated acLed ac-id='1'channel='0'></flute-semi-hole>
                </div>
            </div>
            <div flute >
                <div top-mouthpiece>
                </div>
                <div mouthpiece></div>
                <div top>
                    <div top-inner>
                        <div top-inner2></div>
                    </div>
                </div>
                <div section>
                    <flute-hole acLed ac-id='2' channel='0'></flute-hole>
                    <flute-hole acLed ac-id='3' channel='0'></flute-hole>
                    <flute-hole acLed ac-id='4' channel='0'></flute-hole>
                    <flute-hole acLed ac-id='5' channel='0'></flute-hole>
                    <flute-hole acLed ac-id='6' channel='0'></flute-hole>
                    <div double-hole style='margin-left:13px;'>
                        <flute-hole acLed is-medium ac-id='7'channel='0'></flute-hole>
                        <flute-hole acLed is-small ac-id='8'channel='0'></flute-hole>
                    </div>
                </div>
                <div section lower>
                    <div double-hole style='margin-right:17px;'>
                        <flute-hole acLed is-medium ac-id='9'channel='0'></flute-hole>
                        <flute-hole acLed is-small ac-id='10'channel='0'></flute-hole>
                    </div>
                </div>
                <div bottom-before></div>
                <div bottom></div>
                <div bottom-after>
                    <bottom-hole acLed ac-id='11' channel='0'></bottom-hole>
                </div>
            </div>
        </div>
    </template>
    <script>
        class FluteHoles extends ACLedGroup {
            static get is() { return 'flute-holes'; }
            static get properties() {return {
                midiNoteToGUI:{type:Array,value:[]}
            }}
            constructor() {
                super();
            }
            ___acV_midiEventToAudioNote (channel, midiNote, origin,initiator) {
                if (origin.startsWith('___midi_instrument')  || initiator ==='record')
                    return midiNote ;
                return this.___acV_midiEventToAudioNoteDefault(channel, midiNote, origin);
            }
            ___acV_mapMIDIEventToAcLedId (channel, midiNote, origin ,initiator) {
                if (origin.startsWith('___midi_instrument') || initiator ==='record') {
                    if(this.midiNoteToGUI[midiNote - this.___acV_viewPitchDiff] === undefined ) 
                        return [] ; 

                    return this.midiNoteToGUI[midiNote - this.___acV_viewPitchDiff];
                }

                if (this.midiNoteToGUI[midiNote  + this.___acV_recordingPitchDiff - this.___acV_viewPitchDiff] === undefined) 
                    return [] ; 
                return this.midiNoteToGUI[midiNote  + this.___acV_recordingPitchDiff - this.___acV_viewPitchDiff];
            }
            ___acV_mapMIDIEventToAcLedState (channel,midiNote,origin,initiator) {
                var len ,res = []; 
                if (origin.startsWith('___midi_instrument') || initiator ==='record') {
                    if(this.midiNoteToGUI[midiNote - this.___acV_viewPitchDiff] === undefined ) 
                        return [] ; 
                    len = this.midiNoteToGUI[midiNote - this.___acV_viewPitchDiff ].length;
                    for(let i = 0 ; i < len ; i ++ )
                        res.push(1) ;
                    return res ;
                }

                if (this.midiNoteToGUI[midiNote  + this.___acV_recordingPitchDiff - this.___acV_viewPitchDiff] === undefined) 
                    return [] ; 
                len = this.midiNoteToGUI[midiNote  + this.___acV_recordingPitchDiff - this.___acV_viewPitchDiff ].length ; 
                for(let i = 0 ; i < len ; i ++ )
                    res.push(1) ;
                return res ;
            }
            ready() {
                super.ready() ;
                this.midiNoteToGUI = [] ;

                this.___acV_displayTransposition = true ;
                this.midiNoteToGUI[72] = [0,1,2,3,4,5,6,7,8,9,10]; // C 
                this.midiNoteToGUI[73] = [0,1,2,3,4,5,6,7,8,9]; // C#
                this.midiNoteToGUI[74] = [0,1,2,3,4,5,6,7,8]; // D
                this.midiNoteToGUI[75] = [0,1,2,3,4,5,6,7]; // Eb
                this.midiNoteToGUI[76] = [0,1,2,3,4,5,6]; // E
                this.midiNoteToGUI[77] = [0,1,2,3,4,5,7,8,9,10]; // F
                this.midiNoteToGUI[78] = [0,1,2,3,4,6,7,8]; //  F#
                this.midiNoteToGUI[79] = [0,1,2,3,4]; //  G
                this.midiNoteToGUI[80] = [0,1,2,3,5,6,7]; //  Ab
                this.midiNoteToGUI[81] = [0,1,2,3]; //  A
                this.midiNoteToGUI[82] = [0,1,2,4,5]; //  Bb
                this.midiNoteToGUI[83] = [0,1,2]; //  B

                this.midiNoteToGUI[84] = [0,1,3]; // C 
                this.midiNoteToGUI[85] = [2,3]; //  C#
                this.midiNoteToGUI[86] = [3]; //  D
                this.midiNoteToGUI[87] = [3,4,5,6,7,8]; //  Eb
                this.midiNoteToGUI[88] = [1,2,3,4,5,6]; //  E
                this.midiNoteToGUI[89] = [1,2,3,4,5,7,8]; //  F
                this.midiNoteToGUI[90] = [1,2,3,4,6]; //  F#
                this.midiNoteToGUI[91] = [1,2,3,4]; //  G
                this.midiNoteToGUI[92] = [1,2,3,5]; //  Ab
                this.midiNoteToGUI[93] = [1,2,3]; //  A
                this.midiNoteToGUI[94] = [1,2,3,6,7,8,9]; //  Bb
                this.midiNoteToGUI[95] = [1,2,3,5,6]; //  B

                this.midiNoteToGUI[96] = [1,2,5,6]; //  C
                this.midiNoteToGUI[97] = [1,2,4,5,7,8,9,11]; // C# 
                this.midiNoteToGUI[98] = [1,2,4,5,7,8,9]; // D 
                this.midiNoteToGUI[99] = [1,3,4,6,7,8,9]; // Eb
                this.midiNoteToGUI[100] = [1,3,4,6,7,8,9,11]; // E
                this.midiNoteToGUI[101] = [1,2,3,5,6,11]; // F
                this.midiNoteToGUI[102] = [1,2,3,5,6]; // F #
                this.midiNoteToGUI[103] = [1,2,5]; // G
            }
        }
        customElements.define('flute-holes', FluteHoles);
    </script>
</dom-module>
